# SSE를 사용한 알림 기능 구현

### 프로젝트에 사용될 알림 서비스
- 팀이 생성되었을 때, 혹은 회의 일정이 등록되었을때, 팀원들에게 알릴 필요가 있다고 생각해서, 알림 기능을 구현하였습니다.

### 알림 기능 구현 WebRTC VS SSE
1. webRTC
실시간 양방향 통신으로, 서버와 브라우저가 지속적으로 연결된 TCP 통신을 통해, 클라이언트가 요청을 서버에 보내면, 서버는 그와 관련하여 클라이언트에게 전달하는 방식입니다.
저희 프로젝트에 접목한다면, 팀을 생성하는 클라이언트는 서버에 요청을 보내고, 해당 요청을 전달 받은 서버는 팀원에 속한 클라이언트에게 해당 알림을 전달하는 방식입니다.

2. SSE(server push)
서버에서 클라이언트 방향으로만 통신이되는 단방향 통신 채널입니다. SSE는 클라이언트와 서버가 연결을 유지한 상태에서, 서버에서 변화가 발생할 경우, 이를 클라이언트에게 전달하는 방식입니다.
저희 프로젝트에 접목한다면, 클라이언트가 팀을 생성하는 요청을 서버에게 보냅니다. 이에 서버는 팀을 생성하는 동시에, 다른 클라이언트에게 해당 알림을 전달하는 방식을 SSE라고 합니다.

### SSE를 사용한 이유
- 일반적으로 HTTP요청은 하나의 [요청 - 응답] 과정을 거치고 연결을 종료하지만, 연결 상태를 유지하고 계속 데이터를 보내야 하는 경우도 있습니다. SSE는 이와 같이 한번 연결한 후 서버에서 클라이언트로 데이터를 계속 보낼 때 유리한 기술이라 생각하여 채택하였습니다.
- webRTC와 달리, 별도의 프로토콜을 사용하지 않고 HTTP 프로토콜만 사용하므로 훨씬 가벼움
- 접속에 문제가 있으면 자동으로 재연결을 시도함
- 최대 동시 접속 수는 HTTP/1.1 기준 브라우저 당 6개이지만, 한 클라이언트가 동일한 브라우저를 6개 이상 띄우는 경우는 잘 없다

### SSE 기술
#### 백앤드 Event Stream
spring boot는 SSE 통신을 지원하는 SseEmitter 클래스가 있다. 서버에서는 클라이언트가 네트워크 오류 등의 이유로 이벤트를 수신받지 못할 것을 대비해, 생성된 알림을 저장해두는 EventCache가 존재한다.
이때 서버는 다수의 클라이언트와 연결되기 때문에, 동시성 처리를 위해 ConcurrentHashMap과 같은 Thread-Safe한 자료구조를 사용해야 한다.

#### 프론트앤트 Event Source
SSE 통신을 연결하기 위해, 클라이언트는 서버에 SSE 연결을 요청한다. 이때는 서버로부터 받은 응답을 EventSource를 활용하여 SSE를 연결한다. 연결된 상태에서, EventListner을 사용하여, 연결을 유지한 상태에서, 서버가 보내는 응답을 받는다.