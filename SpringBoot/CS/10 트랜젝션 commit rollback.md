# 트랜잭션 Transaction

쪼갤 수 없는 업무 처리의 최소 단위를 말함

<br>

### 데이터베이스 트랜잭션
데이터베이스 관리 시스템 또는 유사한 시스템에서 상호작용의 단위임.
여기서 유사 시스템이란 트랜잭션이 성공과 실패가 분명하고 상호 독립적이며,
일관되고 믿을 수 있는 시스템을 의미함.

<br>

### 트랜잭션 개념
- DB의 상태를 변경하는 작업 똔느 한번에 수행되어야 하는 연산들을 의미함
- begin, commit을 자동으로 수행해줌
- 예외 발생 시 rollback처리를 자동으로 처리함

<br>

### 트랙잭션 4가지 성질
1. 원자성
 한 트랜잭션 내에서 실행한 작업들은 하나의 단위로 처리함.
 즉 모두 성공 또는 모두 실패.

2. 일관성
트랜잭션은 일관성 있는 데이터베이스 상태를 유지함

3. 격리성
동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않아야함 

4. 영속성
트랜잭션을 성공적으로 마치면 결과가 항상 저장되어야 함(persist)

<br>

### [Spring Boot] Transactional annotation
- 스프링에서는 어노테이션 방식(@Transactional)으로 메서드, 클래스, 인터페이스 위에 추가하여 사용하는 방식이 일반적임.

- 이 방식을 선언적 트랜잭션이라 함

- 적용 범위에서 트랜잭션 기능이 포함된 프록시 객체가 생성되어 자동으로 commit 혹은 rollback을 진행해줌

<br>

```
프록시 객체
- 프록시는 JPA의 실제 엔티티를 필요할때만 꺼내 쓰는 가짜 객체임
- 실제 클래스를 상속받아서 만들어지며, 겉모양이 같기 때문에 이론적으로 사용자가 Proxy 객체를 그대로 써도 문제가 없음
- 프록시 객체는 사진처럼 상속받은 엔티티 타입의 target이라는 필드값이 있음. 실제 데이터가 필요하면 이 target을 통해, id name 등 원래 entity 속성값을 조회함


프록시 객체 왜 쓰나
1. 보안 및 권한 관리
프록시를 사용하면, 특정 객체에 대한 접근을 제어 및 제한할 수 있음. 예를 들어, 사용자가 특정 데이터에 접근 혹은 조작하는 걸 허용하기 전에, 프록시 객체가 사용자의 권한을 확인할 수 있는 거임. 그럼 직접적으로 엔티티를 건드리지 않고, 해당 객체를 사용자 맘대로 접근하고 조작할 수 있는 거네.


2. 지연 로딩 Lazy
프록시는 필요 시점에만 실제 객체를 로드하는 거임. 이건 성능 향상에도 도움됨. 예를 들어, 대용량의 데이터베이스에서 특정 객체를 로드해야하면, 프록시를 사용해서 필요한 순간에 지연 로딩으로 해당 데이터를 로드하는 거지.

왜 성능이 향상된다는 거지? 아래 답변 추가


3. 캐싱
프록시를 통한 작업 결과를 캐싱할 수 있음.
그렇기에 동일한 작업을 반복수행하면, 성능 향상에 도움됨.


4. 로깅 및 감시
프록시를 활용해서 작업하면, 로그를 남기거나 감시할 수 있음.
이건 디버깅 및 시스템 모니터링에 도움됨


5. 트랜잭션 관리
프록시는 특정 작업의 전/후에 추가적인 작업을 수행해서 트랜잭션을 관리할 수 있음
예를 들어, 데이터베이스 작업전에 트랜잭션을 시작하고,
작업 후 작업을 성공하면 자동으로 커밋하고 오류가 발생하면 자동으로 롤백함
```
```
특정 객체를 지연 로딩해서 프록시 객체로 활용하면, 
아래 5가지 이유로 성능 향상에 도움됨.
1. 자원 효율성
모든 객체를 미리 로딩하는 거보다, 필요한 객체만 지연 로딩해서 사용하는 거니깐 자원을 효율적으로 사용함

2. 지연 로딩
프록시가 실제 객체가 필요한 순간까지 데이터를 로딩하지 않는데.
이건 초기화할때 필요한 시간과 자원을 절약하고,
어플리케이션이 특정 객체에 접근할때까지 불필요한 로딩을 안함.

3. 성능 최적화
애초에 모든 데이터를 미리 로딩하는 게 아니라, 필요한 거만 로딩하니깐
성능이 최적화가 되는 거지.

4. 네트워크 비용 감소
웹/어플리케이션에서 특히 네트워크 비용이 중요한데
모든 데이터를 한번에 불러오기보단 필요한 데이터만 요청하면
네트워크 트래픽을 감소시켜서 효율적임

5. 불필요한 계산 회피
당연히 필요한 작업만 수행하니깐, 불필요한 연산을 피할 수 있음
```

<br>

```
commit(=save 라고 생각해도 되려나)
코드 변경 사항 저장 및 기록 하는 행위를 말함
```
```
rollback
보통 예외처리 할때 사용하는 것 같은데, 정의를 보니깐 아래와 같음
- 데이터베이스 관리 시스템이나 트랜잭션 처리에서 사용되는 용어임
- 이전 상태로 되돌리는 작업을 의미함
- 아 그래서 잘못되고 에러나거나 예외발생하면 롤백하는구나
- 데이터베이스에서 특히 트랜잭션이나 쿼리의 일부를 취소하고 
 이전 상태로 돌아가는 걸 말함
```